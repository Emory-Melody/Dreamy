<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Simulation &mdash; EpiLearn 1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=29a6c3e3"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Utilities" href="utils.html" />
    <link rel="prev" title="Pipeline for Epidemic Modeling" href="task_building.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            EpiLearn
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Installation.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Usage</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Quickstart.html">Quickstart for EpiLearn</a></li>
<li class="toctree-l1"><a class="reference internal" href="task_building.html">Pipeline for Epidemic Modeling</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Simulation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#static-properties">Static Properties</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#random-static-graph">Random Static Graph</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#epilearn.utils.simulation.get_random_graph"><code class="docutils literal notranslate"><span class="pre">get_random_graph()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#static-features">Static Features</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#epilearn.utils.simulation.get_graph_from_features"><code class="docutils literal notranslate"><span class="pre">get_graph_from_features()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#gravity-model">Gravity Model</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#epilearn.utils.simulation.Gravity_model"><code class="docutils literal notranslate"><span class="pre">Gravity_model</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dynamic-properties">Dynamic Properties</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#mobility-simulation">Mobility Simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sir">SIR</a></li>
<li class="toctree-l3"><a class="reference internal" href="#networksir">NetworkSIR</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="customization.html">Model&amp;Dataset Customization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Package API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../API/dataset.html">Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API/dataset.html#preprocessed-datasets">Preprocessed Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API/models.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API/models.html#spatial-models">Spatial Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API/models.html#temporal-models">Temporal Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API/models.html#spatial-temporal-models">Spatial-Temporal Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API/tasks.html">Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API/utils.html">Utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API/utils.html#utility-functions">Utility_Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API/utils.html#metrics">Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API/utils.html#simulation">Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API/utils.html#transformation">Transformation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API/utils.html#id2">Utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API/visualization.html">Visualization</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">EpiLearn</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Simulation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tutorials/simulation.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="simulation">
<h1>Simulation<a class="headerlink" href="#simulation" title="Link to this heading"></a></h1>
<p>In this section, we provide a tutorial of the simulation methods in <strong>EpiLearn</strong>. In general, we focus on the simulation of static and dynamic properties including graph structure and node features.</p>
<section id="static-properties">
<h2>Static Properties<a class="headerlink" href="#static-properties" title="Link to this heading"></a></h2>
<section id="random-static-graph">
<h3>Random Static Graph<a class="headerlink" href="#random-static-graph" title="Link to this heading"></a></h3>
<p>A random static graph is a network where nodes are randomly connected with each other. This can be useful for simulating scenarios where connections between nodes do not change over time.</p>
<dl class="py function">
<dt class="sig sig-object py" id="epilearn.utils.simulation.get_random_graph">
<span class="sig-prename descclassname"><span class="pre">epilearn.utils.simulation.</span></span><span class="sig-name descname"><span class="pre">get_random_graph</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num_nodes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">connect_prob</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block_sizes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_edges</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">graph_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'erdos_renyi'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#epilearn.utils.simulation.get_random_graph" title="Link to this definition"></a></dt>
<dd><p>Generates a random static graph using one of the supported graph types: Erdos-Renyi, Stochastic Blockmodel, or Barabasi-Albert.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>num_nodes</strong> (<em>int</em>) – Number of nodes in the graph.</p></li>
<li><p><strong>connect_prob</strong> (<em>float</em><em>, </em><em>optional</em>) – Probability of edge creation (for Erdos-Renyi and Stochastic Blockmodel graphs).</p></li>
<li><p><strong>block_sizes</strong> (<em>list</em><em> of </em><em>int</em><em>, </em><em>optional</em>) – Sizes of blocks (for Stochastic Blockmodel graph).</p></li>
<li><p><strong>num_edges</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of edges (for Barabasi-Albert graph).</p></li>
<li><p><strong>graph_type</strong> (<em>str</em>) – Type of graph to generate. Options are <cite>‘erdos_renyi’</cite>, <cite>‘stochastic_blockmodel’</cite>, <cite>‘barabasi_albert’</cite>. Default is <cite>‘erdos_renyi’</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Adjacency matrix of the generated graph.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>torch.Tensor</p>
</dd>
</dl>
</dd></dl>

<p>When the function accepts inputs as number of nodes and connect probability, it will randomly generate a graph.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">epilearn</span>

<span class="n">adj</span> <span class="o">=</span> <span class="n">epilearn</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">get_random_graph</span><span class="p">(</span><span class="n">num_nodes</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">connect_prob</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">block_sizes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_edges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">graph_type</span><span class="o">=</span><span class="s1">&#39;erdos_renyi&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="static-features">
<h3>Static Features<a class="headerlink" href="#static-features" title="Link to this heading"></a></h3>
<p>Static features are fixed attributes assigned to nodes or edges in a graph. These features do not change over time.</p>
<dl class="py function">
<dt class="sig sig-object py" id="epilearn.utils.simulation.get_graph_from_features">
<span class="sig-prename descclassname"><span class="pre">epilearn.utils.simulation.</span></span><span class="sig-name descname"><span class="pre">get_graph_from_features</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">features</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">adj</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">G</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#epilearn.utils.simulation.get_graph_from_features" title="Link to this definition"></a></dt>
<dd><p>Generate a graph from node features using cosine similarity.</p>
<p>This function generates a graph where each edge weight is computed based on the cosine similarity
between the feature vectors of the connected nodes. If an adjacency matrix is provided, the cosine
similarity is adjusted by the corresponding entry in the adjacency matrix.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>features</strong> (<em>torch.Tensor</em>) – A tensor of shape (num_nodes, feat_dim) where num_nodes is the number of nodes and feat_dim is
the dimensionality of the feature vectors.</p></li>
<li><p><strong>adj</strong> (<em>torch.Tensor</em><em>, </em><em>optional</em>) – A tensor of shape (num_nodes, num_nodes) representing the adjacency matrix, where adj[i, j]
denotes the distance or weight between node i and node j. If None, the cosine similarity is
used directly as the edge weight. Default is None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A tensor of shape (num_nodes, num_nodes) representing the generated graph’s adjacency matrix,
where each entry [i, j] contains the adjusted cosine similarity between nodes i and j.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>torch.Tensor</p>
</dd>
</dl>
</dd></dl>

<p>Given static node features, a graph can be obtained by calculating cosine similarity between each nodes. The adj parameter is used to indicate the distance between nodes, adding penalty on similarities.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">epilearn</span>
<span class="kn">import</span> <span class="nn">torch</span>

<span class="c1"># Randomly generate a 10x20 feature matrix. 10 is the number of node and 20 is the feature dimension.</span>
<span class="n">feature</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>

<span class="c1"># Randomly generate a adjacency matrix by 10 nodes.</span>
<span class="n">adj</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="c1"># The feature, adj and any other parameters can be replaced by your own.</span>
<span class="n">graph1</span> <span class="o">=</span> <span class="n">epilearn</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">get_graph_from_features</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span> <span class="n">adj</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">graph2</span> <span class="o">=</span> <span class="n">epilearn</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">get_graph_from_features</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span> <span class="n">adj</span><span class="o">=</span><span class="n">adj</span><span class="p">)</span> <span class="c1"># If providing adj, then the similarity will be divided by distance in adj repectively.</span>
</pre></div>
</div>
</section>
<section id="gravity-model">
<h3>Gravity Model<a class="headerlink" href="#gravity-model" title="Link to this heading"></a></h3>
<p>The gravity model is used to simulate the interaction between nodes based on their attributes and distance. It’s often used in spatial analysis. For example, in epidemic, it can be used to capture the regional contact and transmission patterns invoked
by human mobility. The Gravity_model class follows the <a class="reference external" href="https://dl.acm.org/doi/pdf/10.1145/3589132.3625596">equation</a> as shown in annotations. For parameter settings, follow the <a class="reference external" href="https://www.pnas.org/doi/epdf/10.1073/pnas.0906910106">empirical parameters</a>:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 25.0%" />
<col style="width: 25.0%" />
<col style="width: 25.0%" />
<col style="width: 25.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>distance (km)</p></th>
<th class="head"><p>source</p></th>
<th class="head"><p>target</p></th>
<th class="head"><p>s (km)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>≤ 300</p></td>
<td><p>0.46 ± 0.01</p></td>
<td><p>0.64 ± 0.01</p></td>
<td><p>82 ± 2</p></td>
</tr>
<tr class="row-odd"><td><p>&gt; 300</p></td>
<td><p>0.35 ± 0.06</p></td>
<td><p>0.37 ± 0.06</p></td>
<td><p>N/A</p></td>
</tr>
</tbody>
</table>
<dl class="py class">
<dt class="sig sig-object py" id="epilearn.utils.simulation.Gravity_model">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">epilearn.utils.simulation.</span></span><span class="sig-name descname"><span class="pre">Gravity_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">s</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#epilearn.utils.simulation.Gravity_model" title="Link to this definition"></a></dt>
<dd><p>A class to represent a gravity model for mobility analysis in an epidemic context.</p>
<p>The gravity model is used to estimate the influence and mobility between nodes (e.g., cities or regions)
based on their populations and the distance between them, according to the formula:</p>
<div class="math notranslate nohighlight">
\[e_{v,w} = \frac{N_v^{\rho} N_w^{\theta}}{\exp(d_{vw} / \delta)},\forall v, w \in \mathcal{V}\]</div>
<dl class="py method">
<dt class="sig sig-object py" id="epilearn.utils.simulation.Gravity_model.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">s</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#epilearn.utils.simulation.Gravity_model.__init__" title="Link to this definition"></a></dt>
<dd><p>Initialize the Gravity_model with specified parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>source</strong> (<em>float</em>) – Exponent for the source node population <span class="math notranslate nohighlight">\(\rho\)</span> in the gravity model.</p></li>
<li><p><strong>target</strong> (<em>float</em>) – Exponent for the target node population <span class="math notranslate nohighlight">\(\theta\)</span> in the gravity model.</p></li>
<li><p><strong>s</strong> (<em>float</em>) – Scaling factor for the distance <span class="math notranslate nohighlight">\(\delta\)</span> in the gravity model.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="epilearn.utils.simulation.Gravity_model.get_influence">
<span class="sig-name descname"><span class="pre">get_influence</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source_population</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_population</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">distance</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#epilearn.utils.simulation.Gravity_model.get_influence" title="Link to this definition"></a></dt>
<dd><p>Calculate the influence between a source and a target node based on their populations and the distance between them.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>source_population</strong> (<em>float</em>) – Population of the source node <span class="math notranslate nohighlight">\(N_v\)</span>.</p></li>
<li><p><strong>target_population</strong> (<em>float</em>) – Population of the target node <span class="math notranslate nohighlight">\(N_w\)</span>.</p></li>
<li><p><strong>distance</strong> (<em>float</em>) – Distance between the source and target nodes <span class="math notranslate nohighlight">\(d_{vw}\)</span>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The calculated influence between the source and target nodes.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="epilearn.utils.simulation.Gravity_model.get_mobility_graph">
<span class="sig-name descname"><span class="pre">get_mobility_graph</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">node_populations</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">distance_graph</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#epilearn.utils.simulation.Gravity_model.get_mobility_graph" title="Link to this definition"></a></dt>
<dd><p>Generate a mobility graph based on node populations and a distance graph.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>node_populations</strong> (<em>torch.Tensor</em>) – A tensor of shape (num_nodes,) representing the population of each node.</p></li>
<li><p><strong>distance_graph</strong> (<em>torch.Tensor</em>) – A tensor of shape (num_nodes, num_nodes) representing the distances between nodes.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A tensor of shape (num_nodes, num_nodes) representing the mobility graph, where each entry [i, j]
represents the mobility influence from node i to node j.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>torch.Tensor</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<p>Given population numbers in each node (or say region) and distance between each node, edge weights can be obtained along with given each parameter.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">epilearn</span>
<span class="kn">import</span> <span class="nn">torch</span>

<span class="c1"># Assume we have three nodes, and the populations for the three nodes.</span>
<span class="n">node_populations</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">1500</span><span class="p">])</span>

<span class="c1"># Assume the distance between each node.</span>
<span class="n">distance_graph</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="p">])</span>

<span class="c1"># Create gravity model by giving the three parameters</span>
<span class="n">gravity_model</span> <span class="o">=</span> <span class="n">epilearn</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">Gravity_model</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="mf">0.46</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="mf">0.64</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">82</span><span class="p">)</span>

<span class="c1"># Choose two nodes from the graph along with their distance, and get the influence between this node pair.</span>
<span class="n">source_population</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">target_population</span> <span class="o">=</span> <span class="mi">2000</span>
<span class="n">distance</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">influence</span> <span class="o">=</span> <span class="n">gravity_model</span><span class="o">.</span><span class="n">get_influence</span><span class="p">(</span><span class="n">source_population</span><span class="p">,</span> <span class="n">target_population</span><span class="p">,</span> <span class="n">distance</span><span class="p">)</span>

<span class="c1"># Use population for each node and the distances to generate a set of graph weight, forming an adjency matrix.</span>
<span class="n">mobility_graph</span> <span class="o">=</span> <span class="n">gravity_model</span><span class="o">.</span><span class="n">get_mobility_graph</span><span class="p">(</span><span class="n">node_populations</span><span class="p">,</span> <span class="n">distance_graph</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="dynamic-properties">
<h2>Dynamic Properties<a class="headerlink" href="#dynamic-properties" title="Link to this heading"></a></h2>
<section id="mobility-simulation">
<h3>Mobility Simulation<a class="headerlink" href="#mobility-simulation" title="Link to this heading"></a></h3>
<p>Mobility simulation models the movement of nodes over time, which can represent entities such as people or vehicles in a network.</p>
<p>Next, we will specify how to use <a class="reference external" href="https://epilearn-doc.readthedocs.io/en/latest/API/utils.html#time-geo">Time Geo</a> to simulate mobility.</p>
<p>First, we randomly generate a set of GPS coordinates. These coordinates will serve as the regions within which individuals will move. The generated GPS data simulates the geographic regions in which our individuals will perform their activities. This is essential for the Time_geo class to simulate realistic movements based on geographic locations.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">num_gps_points</span> <span class="o">=</span> <span class="mi">4528</span>
<span class="n">base_latitude</span> <span class="o">=</span> <span class="mf">35.51168469</span>
<span class="n">base_longitude</span> <span class="o">=</span> <span class="mf">139.6733776</span>
<span class="n">latitude_variation</span> <span class="o">=</span> <span class="mf">0.0005</span>
<span class="n">longitude_variation</span> <span class="o">=</span> <span class="mf">0.012</span>

<span class="n">gps_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_gps_points</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_gps_points</span><span class="p">):</span>
    <span class="n">random_latitude_shift</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">latitude_variation</span><span class="p">,</span> <span class="n">latitude_variation</span><span class="p">)</span>
    <span class="n">random_longitude_shift</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">longitude_variation</span><span class="p">,</span> <span class="n">longitude_variation</span><span class="p">)</span>
    <span class="n">gps_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">base_latitude</span> <span class="o">+</span> <span class="n">random_latitude_shift</span>
    <span class="n">gps_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">base_longitude</span> <span class="o">+</span> <span class="n">random_longitude_shift</span>
</pre></div>
</div>
<p>Next we define several helper functions to process the trajectories of individuals:</p>
<ol class="arabic simple">
<li><p><strong>padding</strong>: Pads the trajectory data to ensure consistent time intervals.</p></li>
<li><p><strong>fixed</strong>: Aggregates the padded trajectory data into fixed time slots.</p></li>
<li><p><strong>to_fixed</strong>: Converts trajectories to a fixed time resolution.</p></li>
<li><p><strong>to_std</strong>: Standardizes the trajectories into a specific format.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">padding</span><span class="p">(</span><span class="n">traj</span><span class="p">,</span> <span class="n">tim_size</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">intcount</span><span class="p">(</span><span class="n">seq</span><span class="p">):</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">seq</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">seq</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">a</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">locs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(([</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">traj</span><span class="p">[</span><span class="s1">&#39;loc&#39;</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">tims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(([</span><span class="mi">0</span><span class="p">],</span> <span class="n">traj</span><span class="p">[</span><span class="s1">&#39;tim&#39;</span><span class="p">]</span> <span class="o">%</span> <span class="n">tim_size</span><span class="p">,</span> <span class="p">[</span><span class="n">tim_size</span><span class="p">]))</span>
    <span class="n">tims</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">tims</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="n">tims</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">tims</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span> <span class="k">else</span> <span class="n">tims</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="n">locs</span><span class="p">[</span><span class="nb">id</span><span class="p">]]</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">intcount</span><span class="p">(</span><span class="n">tims</span><span class="p">))])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">fixed</span><span class="p">(</span><span class="n">pad_traj</span><span class="p">,</span> <span class="n">slot</span> <span class="o">=</span> <span class="mi">30</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">((</span><span class="n">pad_traj</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)[(</span><span class="n">slot</span><span class="o">*</span><span class="n">i</span><span class="p">):(</span><span class="n">slot</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="n">slot</span><span class="p">)]))</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pad_traj</span><span class="p">)</span><span class="o">/</span><span class="n">slot</span><span class="p">))])</span>

<span class="k">def</span> <span class="nf">to_fixed</span><span class="p">(</span><span class="n">traj</span><span class="p">,</span> <span class="n">tim_size</span><span class="p">,</span> <span class="n">slot</span> <span class="o">=</span> <span class="mi">30</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">fixed</span><span class="p">(</span><span class="n">padding</span><span class="p">(</span><span class="n">traj</span><span class="p">,</span> <span class="n">tim_size</span><span class="p">),</span> <span class="n">slot</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">a</span><span class="o">==-</span><span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">a</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">to_std</span><span class="p">(</span><span class="n">traj</span><span class="p">,</span> <span class="n">tim_size</span><span class="p">,</span> <span class="n">detrans</span><span class="p">,</span> <span class="n">time_slot</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">traj</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">!=</span> <span class="n">traj</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">loc</span><span class="p">,</span> <span class="n">tim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">detrans</span><span class="p">,</span>  <span class="n">traj</span><span class="p">[</span><span class="nb">id</span><span class="p">]))),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tim_size</span><span class="p">,</span> <span class="n">time_slot</span><span class="p">)[</span><span class="nb">id</span><span class="p">]</span>
    <span class="n">sta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tim</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">tim_size</span><span class="p">)</span> <span class="o">-</span> <span class="n">tim</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="n">loc</span><span class="p">,</span> <span class="s1">&#39;tim&#39;</span><span class="p">:</span><span class="n">tim</span><span class="p">,</span> <span class="s1">&#39;sta&#39;</span><span class="p">:</span> <span class="n">sta</span><span class="p">}</span>
</pre></div>
</div>
<p>Define a TimeGeo function utilizes the Time_geo class to simulate trajectories based on the input data and parameters.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">epilearn</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">TimeGeo</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
    <span class="n">TG</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">gen_bar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">uid</span><span class="p">,</span> <span class="n">trajs</span> <span class="ow">in</span> <span class="n">gen_bar</span><span class="p">:</span>
        <span class="n">gen_bar</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="s2">&quot;TimeGeo - Generating trajectories for user: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">uid</span><span class="p">))</span>

        <span class="n">locations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">trajs</span><span class="p">[</span><span class="n">traj</span><span class="p">][</span><span class="s1">&#39;loc&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">traj</span> <span class="ow">in</span> <span class="n">trajs</span><span class="p">])))</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">locations</span> <span class="o">==</span> <span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">detrans</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">locations</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>

        <span class="nb">input</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">to_fixed</span><span class="p">({</span><span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">trans</span><span class="p">,</span> <span class="n">traj</span><span class="p">[</span><span class="s1">&#39;loc&#39;</span><span class="p">])),</span> <span class="s1">&#39;tim&#39;</span><span class="p">:</span> <span class="n">traj</span><span class="p">[</span><span class="s1">&#39;tim&#39;</span><span class="p">],</span> <span class="s1">&#39;sta&#39;</span><span class="p">:</span> <span class="n">traj</span><span class="p">[</span><span class="s1">&#39;sta&#39;</span><span class="p">]},</span> <span class="n">param</span><span class="o">.</span><span class="n">tim_size</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="k">for</span> <span class="n">traj</span> <span class="ow">in</span> <span class="n">trajs</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
        <span class="n">time_geo</span> <span class="o">=</span> <span class="n">epilearn</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">Time_geo</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">GPS</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">locations</span><span class="p">)],</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">cumprod</span><span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">shape</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">simu_slot</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">tim_size</span><span class="o">//</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">TG</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="nb">id</span><span class="p">:</span> <span class="n">to_std</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;trace&#39;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">param</span><span class="o">.</span><span class="n">tim_size</span><span class="p">,</span> <span class="n">detrans</span><span class="p">)</span> <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">time_geo</span><span class="o">.</span><span class="n">pop_info</span><span class="p">)}</span>

    <span class="k">return</span> <span class="n">TG</span>
</pre></div>
</div>
<p>Define Parameters class holds the data type and GPS information needed for the simulation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Parameters</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_type</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_type</span> <span class="o">=</span> <span class="n">data_type</span>

    <span class="k">def</span> <span class="nf">data_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">GPS</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GPS</span> <span class="o">=</span> <span class="n">GPS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tim_size</span> <span class="o">=</span> <span class="mi">1440</span>

<span class="n">data_type</span> <span class="o">=</span> <span class="s1">&#39;Example Data&#39;</span>
<span class="n">param</span> <span class="o">=</span> <span class="n">Parameters</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span>

<span class="n">param</span><span class="o">.</span><span class="n">data_info</span><span class="p">(</span><span class="n">gps_data</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally define a sample data set and run the TimeGeo function to simulate the movement patterns.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">1</span><span class="p">:</span> <span class="p">{</span>
        <span class="mi">0</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3744</span><span class="p">,</span> <span class="mi">1901</span><span class="p">,</span> <span class="mi">1995</span><span class="p">,</span> <span class="mi">2653</span><span class="p">,</span> <span class="mi">2743</span><span class="p">,</span> <span class="mi">2744</span><span class="p">,</span> <span class="mi">2654</span><span class="p">,</span> <span class="mi">2743</span><span class="p">,</span> <span class="mi">2745</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
            <span class="s1">&#39;tim&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">6075.83333333</span><span class="p">,</span> <span class="mf">6113.5</span><span class="p">,</span> <span class="mf">6503.81666667</span><span class="p">,</span> <span class="mf">6518.23333333</span><span class="p">,</span> <span class="mf">6568.8</span><span class="p">,</span> <span class="mf">6640.73333333</span><span class="p">,</span> <span class="mf">6664.25</span><span class="p">,</span> <span class="mf">6708.61666667</span><span class="p">,</span> <span class="mf">6747.83333333</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
            <span class="s1">&#39;sta&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">37.66666667</span><span class="p">,</span> <span class="mf">390.31666667</span><span class="p">,</span> <span class="mf">14.41666667</span><span class="p">,</span> <span class="mf">50.56666667</span><span class="p">,</span> <span class="mf">71.93333333</span><span class="p">,</span> <span class="mf">23.51666667</span><span class="p">,</span> <span class="mf">44.36666667</span><span class="p">,</span> <span class="mf">39.21666667</span><span class="p">,</span> <span class="mf">99.75</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="p">},</span>
        <span class="mi">1</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2653</span><span class="p">,</span> <span class="mi">2744</span><span class="p">,</span> <span class="mi">2654</span><span class="p">,</span> <span class="mi">2653</span><span class="p">,</span> <span class="mi">2654</span><span class="p">,</span> <span class="mi">2653</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
            <span class="s1">&#39;tim&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">297580.38333333</span><span class="p">,</span> <span class="mf">297645.8</span><span class="p">,</span> <span class="mf">297661.83333333</span><span class="p">,</span> <span class="mf">297682.41666667</span><span class="p">,</span> <span class="mf">297693.05</span><span class="p">,</span> <span class="mf">297788.05</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
            <span class="s1">&#39;sta&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">65.41666667</span><span class="p">,</span> <span class="mf">16.03333333</span><span class="p">,</span> <span class="mf">20.58333333</span><span class="p">,</span> <span class="mf">10.63333333</span><span class="p">,</span> <span class="mf">95.0</span><span class="p">,</span> <span class="mf">10.58333333</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="mi">3</span><span class="p">:</span> <span class="p">{</span>
        <span class="mi">0</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2244</span><span class="p">,</span> <span class="mi">2173</span><span class="p">,</span> <span class="mi">2248</span><span class="p">,</span> <span class="mi">2395</span><span class="p">,</span> <span class="mi">2547</span><span class="p">,</span> <span class="mi">2477</span><span class="p">,</span> <span class="mi">1853</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
            <span class="s1">&#39;tim&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">11740.61666667</span><span class="p">,</span> <span class="mf">11757.53333333</span><span class="p">,</span> <span class="mf">11778.65</span><span class="p">,</span> <span class="mf">11819.31666667</span><span class="p">,</span> <span class="mf">11833.56666667</span><span class="p">,</span> <span class="mf">12035.68333333</span><span class="p">,</span> <span class="mf">12064.13333333</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
            <span class="s1">&#39;sta&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">16.91666667</span><span class="p">,</span> <span class="mf">21.11666667</span><span class="p">,</span> <span class="mf">40.66666667</span><span class="p">,</span> <span class="mf">14.25</span><span class="p">,</span> <span class="mf">202.11666667</span><span class="p">,</span> <span class="mf">28.45</span><span class="p">,</span> <span class="mf">1383.16666667</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="mi">5</span><span class="p">:</span> <span class="p">{</span>
        <span class="mi">0</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2741</span><span class="p">,</span> <span class="mi">2654</span><span class="p">,</span> <span class="mi">2653</span><span class="p">,</span> <span class="mi">2743</span><span class="p">,</span> <span class="mi">2341</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
            <span class="s1">&#39;tim&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">89855.71666667</span><span class="p">,</span> <span class="mf">89881.15</span><span class="p">,</span> <span class="mf">89909.1</span><span class="p">,</span> <span class="mf">90020.8</span><span class="p">,</span> <span class="mf">90216.95</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
            <span class="s1">&#39;sta&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">25.43333333</span><span class="p">,</span> <span class="mf">27.95</span><span class="p">,</span> <span class="mf">111.7</span><span class="p">,</span> <span class="mf">196.15</span><span class="p">,</span> <span class="mf">34.91666667</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="p">},</span>
        <span class="mi">1</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2653</span><span class="p">,</span> <span class="mi">2744</span><span class="p">,</span> <span class="mi">2653</span><span class="p">,</span> <span class="mi">2823</span><span class="p">,</span> <span class="mi">2744</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
            <span class="s1">&#39;tim&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">236819.35</span><span class="p">,</span> <span class="mf">236892.11666667</span><span class="p">,</span> <span class="mf">236908.31666667</span><span class="p">,</span> <span class="mf">236923.75</span><span class="p">,</span> <span class="mf">237041.66666667</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
            <span class="s1">&#39;sta&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">72.76666667</span><span class="p">,</span> <span class="mf">16.2</span><span class="p">,</span> <span class="mf">15.43333333</span><span class="p">,</span> <span class="mf">117.91666667</span><span class="p">,</span> <span class="mf">32.93333333</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="p">},</span>
        <span class="mi">2</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2653</span><span class="p">,</span> <span class="mi">2652</span><span class="p">,</span> <span class="mi">2744</span><span class="p">,</span> <span class="mi">2653</span><span class="p">,</span> <span class="mi">2743</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span>
            <span class="s1">&#39;tim&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">75474.86666667</span><span class="p">,</span> <span class="mf">75494.3</span><span class="p">,</span> <span class="mf">75563.6</span><span class="p">,</span> <span class="mf">75598.66666667</span><span class="p">,</span> <span class="mf">75629.6</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
            <span class="s1">&#39;sta&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">19.43333333</span><span class="p">,</span> <span class="mf">69.3</span><span class="p">,</span> <span class="mf">35.06666667</span><span class="p">,</span> <span class="mf">30.93333333</span><span class="p">,</span> <span class="mf">142.6</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">simulated_data</span> <span class="o">=</span> <span class="n">TimeGeo</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="sir">
<h3>SIR<a class="headerlink" href="#sir" title="Link to this heading"></a></h3>
<p>The SIR model is a simple mathematical model used to simulate the spread of a disease through a population. This class has three vital initial parameters:</p>
<ol class="arabic simple">
<li><p><strong>horizon</strong>: The total number of time steps for the simulation.</p></li>
<li><p><strong>infection_rate</strong>: The rate at which susceptible individuals get infected.</p></li>
<li><p><strong>recovery_rate</strong>: The rate at which infected individuals recover.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">epilearn</span>
<span class="kn">import</span> <span class="nn">torch</span>

<span class="c1"># Set two infected individuals: 3, 10, the first column represents S, the second is I, and the thirs is R.</span>
<span class="n">initial_states</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># [S,I,R]</span>
<span class="n">initial_states</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">initial_states</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">initial_states</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">initial_states</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">initial_states</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># Create an instance of the SIR model with specified parameters.</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">epilearn</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Temporal</span><span class="o">.</span><span class="n">SIR</span><span class="p">(</span><span class="n">horizon</span><span class="o">=</span><span class="mi">190</span><span class="p">,</span> <span class="n">infection_rate</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">recovery_rate</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>

<span class="c1"># Run the model to generate predictions.</span>
<span class="c1"># Steps control the number of steps for the simulation. If None, it runs for the full horizon.</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">initial_states</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">steps</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>

<span class="c1"># Plot the simulation.</span>
<span class="n">layout</span> <span class="o">=</span> <span class="n">epilearn</span><span class="o">.</span><span class="n">visualize</span><span class="o">.</span><span class="n">plot_series</span><span class="p">(</span><span class="n">preds</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Suspected&#39;</span><span class="p">,</span> <span class="s1">&#39;Infected&#39;</span><span class="p">,</span> <span class="s1">&#39;Recovered&#39;</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="networksir">
<h3>NetworkSIR<a class="headerlink" href="#networksir" title="Link to this heading"></a></h3>
<p>The NetworkSIR model extends the SIR model by simulating the disease spread over a network, taking into account the network structure. This class has four vital initial parameters:</p>
<ol class="arabic simple">
<li><p><strong>num_nodes</strong>: The number of nodes in the network.</p></li>
<li><p><strong>horizon</strong>: The total number of time steps for the simulation.</p></li>
<li><p><strong>infection_rate</strong>: The rate at which susceptible nodes get infected.</p></li>
<li><p><strong>recovery_rate</strong>: The rate at which infected nodes recover.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">epilearn</span>
<span class="kn">import</span> <span class="nn">torch</span>

<span class="c1"># Generate random static graph</span>
<span class="n">initial_graph</span> <span class="o">=</span> <span class="n">epilearn</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">get_random_graph</span><span class="p">(</span><span class="n">num_nodes</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">connect_prob</span><span class="o">=</span><span class="mf">0.20</span><span class="p">)</span>

<span class="c1"># Set two infected individuals: 3, 10, the first column represents S, the second is I, and the thirs is R.</span>
<span class="n">initial_states</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># [S,I,R]</span>
<span class="n">initial_states</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">initial_states</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">initial_states</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">initial_states</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">initial_states</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># Create an instance of the NetworkSIR model with specified parameters.</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">epilearn</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">SpatialTemporal</span><span class="o">.</span><span class="n">NetworkSIR</span><span class="o">.</span><span class="n">NetSIR</span><span class="p">(</span><span class="n">num_nodes</span><span class="o">=</span><span class="n">initial_graph</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">horizon</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">infection_rate</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">recovery_rate</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>

<span class="c1"># Run the model to generate predictions.</span>
<span class="c1"># Steps control the number of steps for the simulation. If None, it runs for the full horizon.</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">initial_states</span><span class="p">,</span> <span class="n">initial_graph</span><span class="p">,</span> <span class="n">steps</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>

<span class="c1"># Plot the simulation.</span>
<span class="n">layout</span> <span class="o">=</span> <span class="n">epilearn</span><span class="o">.</span><span class="n">visualize</span><span class="o">.</span><span class="n">plot_graph</span><span class="p">(</span><span class="n">preds</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="mi">2</span><span class="p">)[</span><span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">initial_graph</span><span class="o">.</span><span class="n">to_sparse</span><span class="p">()</span><span class="o">.</span><span class="n">indices</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">classes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Suspected&#39;</span><span class="p">,</span> <span class="s1">&#39;Infected&#39;</span><span class="p">,</span> <span class="s1">&#39;Recovered&#39;</span><span class="p">])</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="task_building.html" class="btn btn-neutral float-left" title="Pipeline for Epidemic Modeling" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="utils.html" class="btn btn-neutral float-right" title="Utilities" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Melody Group.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>